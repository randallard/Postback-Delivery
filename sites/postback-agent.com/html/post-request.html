<html>
<head>
<title>Postback Agent Test</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>

var postData;
var postTo = 'i';
$(document).ready(function(){
	setPostData();
	$('#switchWatch').click(function(){
               	$('#stopwatch').text( $('#stopwatch').text() == 'on' ? 'off' : 'on' );
		setPostData();
        });
	$('#switchMethod').click(function(){
               	$('#formMethod').text( $('#formMethod').text() == 'POST' ? 'GET' : 'POST' );
		setPostData();
        });
	$('#ingest').click(function(){
		postTo = 'ingest.php';
		postAJAX();	
	});
	$('#justI').click(function(){
		postTo = 'i';
		postAJAX();	
	});
});
function setPostData() {
	postData = {
          endpoint:{
            method: $('#formMethod').text(),
            url:"http://receiver-one.com/data?key={key}&value={value}&foo={bar}"
          },
          data:[
            {
              key:"Azureus",
              value:"Dendrobates"
            },
            {
              key:"Phyllobates",
              value:"Terribilis"
            }
          ]
        };
}
function postAJAX(){
        //var dateNow = new Date();
        //$("#divResponse").prepend("<p>Posted Data to /" + postTo + " :" + JSON.stringify(postData) + "<br />Sent at: ["+dateNow.toLocaleString()+"]</p>");

        // add s1 property to postData to hold first send time for analytics
        if ( $('#stopwatch').text() == 'on' ) { 
		postData.S1 = (new Date()).getTime(); 
	        $("#divResponse").prepend("<p>Posted Data to /" + postTo + " :" + JSON.stringify(postData) + "<br />Sent at: ["+postData.S1.toLocaleString()+"]</p>");
	}
	else {
	        $("#divResponse").prepend("<p>Posted Data to /" + postTo + " :" + JSON.stringify(postData) + "<br />Sent at: ["+ (new Date()).getTime()+"]</p>");
	}
	
	$.ajax({
	    type: 'POST',
	    url: 'http://postback-agent.com/' + postTo,
	    data: JSON.stringify(postData),
	    success: function(xhr, status, result){
			$("#divResponse").prepend("Success:"+JSON.stringify(result)+"<br />");
	},

 

    // Code to run if the request fails; the raw request and

    // status codes are passed to the function

    error: function( xhr, status, errorThrown ) {

        $("#divResponse").prepend( "Error: " + errorThrown +"<br />");

        $("#divResponse").prepend( "Status: " + status +"<br />");

        $("#divResponse").prepend( "XHR: " + xhr +"<br />");

    },

 

    // Code to run regardless of success or failure

    complete: function( xhr, status ) {

        $("#divResponse").prepend( "The request is complete!<br />" );

    }

	
	});
}
</script>
</head>
<body>
Stopwatch: <span id='stopwatch'>on</span> <button id='switchWatch'>Switch Stopwatch</button><br />
Method: <span id='formMethod'>GET</span> <button id='switchMethod'>Switch Method</button><br />
<button id='justI'>Post to /i</button>
<button id='ingest'>Post to /ingest.php</button>
<h2>Response:</h2>
<div id="divResponse"></div>

</body>
</html>

